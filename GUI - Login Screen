package cal;

import java.io.IOException;
import javax.swing.*;
import java.awt.*;
import java.awt.event.*;

@SuppressWarnings({"serial", "static-access"})
public class Login extends JFrame {
    private static JButton jButton1 = new JButton(), jButton2 = new JButton();
    private static JLabel jLabel1 = new JLabel(), jLabel2 = new JLabel(),
    		jLabel3 = new JLabel("<HTML><font face = 'Sitka Heading' size = '36'><I><U>The Calendar</U></I></font></HTML>", SwingConstants.CENTER),
    		jLabel4 = new JLabel(), jLabel5 = new JLabel();
    
    private static JPanel jPanel1 = new JPanel();
    private static JTextField jTextField2 = new JTextField();
    private static JPasswordField jp1 = new JPasswordField();
    private static Login one;
    private static SQLHelper help = new SQLHelper();
    private static User user;
    
    public Login() {
    	 
        try {
    			UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
    		} catch (ClassNotFoundException e) {
    			// TODO Auto-generated catch block
    			e.printStackTrace();
    		} catch (InstantiationException e) {
    			// TODO Auto-generated catch block
    			e.printStackTrace();
    		} catch (IllegalAccessException e) {
    			// TODO Auto-generated catch block
    			e.printStackTrace();
    		} catch (UnsupportedLookAndFeelException e) {
    			// TODO Auto-generated catch block
    			e.printStackTrace();
    		}
    		String lcOSName = System.getProperty("os.name").toLowerCase();
    		boolean IS_MAC = lcOSName.startsWith("mac os x");
    		System.setProperty("apple.laf.useScreenMenuBar", String.valueOf(IS_MAC));
    
        initComponents();
        
        setDefaultCloseOperation(JDialog.DO_NOTHING_ON_CLOSE);
        addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent e) {
                help.closePath();
                System.exit(1);
            }
        });
    }
    
    private void initComponents() {
    	setTitle("Login");
    	setJMenuBar(MenuExp.PrepareMenuBar(" "));
        
        jLabel5.setVisible(false);
        jPanel1.setPreferredSize(new Dimension(500, 385));
        jTextField2.setText("");
        jTextField2.setCursor(new Cursor(Cursor.DEFAULT_CURSOR));
        jTextField2.setName("user"); 
        jTextField2.setSelectedTextColor(new Color(153, 153, 153));
        jTextField2.setVerifyInputWhenFocusTarget(false);
        jLabel1.setFont(new Font("Tahoma", 0, 14));
        jLabel1.setText("Username:");
        jLabel2.setFont(new Font("Tahoma", 0, 14));
        jLabel2.setText("Password:"); 
        jLabel4.setFont(new Font("Sitka Heading", 2, 36));
        jLabel5.setForeground(new Color(204, 0, 0));
        jLabel5.setText("Invalid Username/Password");
        jButton1.setFont(new Font("Franklin Gothic Heavy", 0, 18));
        jButton1.setText("Login");
        
        jButton1.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jButton2.setForeground(new Color(0, 102, 204));
        jButton2.setText("<HTML><U>Create New User</U><HTML>");
        jButton2.setBorderPainted(false);
        jButton2.setContentAreaFilled(false);
        jButton2.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
            	  NewUser.paintFrame();
          		  one.rootPane.repaint();
          		  one.setVisible(false);

            }
        });

        //allows user to press enter instead of clicking the "Login" button
        jp1.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
            	validateInput();	
            }
        });
        
        jTextField2.setCursor(new Cursor(Cursor.TEXT_CURSOR));
        
        GroupLayout jPanel1Layout = new GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup( GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel4,  GroupLayout.DEFAULT_SIZE,  GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup( GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap( GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup( GroupLayout.Alignment.LEADING, false)
                    .addComponent(jLabel1,  GroupLayout.DEFAULT_SIZE, 85, Short.MAX_VALUE)
                    .addComponent(jLabel2,  GroupLayout.DEFAULT_SIZE,  GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(30, 30, 30)
                .addGroup(jPanel1Layout.createParallelGroup( GroupLayout.Alignment.LEADING, false)
                    .addComponent(jTextField2,  GroupLayout.DEFAULT_SIZE, 159, Short.MAX_VALUE)
                    .addComponent(jp1))
                .addGap(132, 132, 132))
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup( GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(173, 173, 173)
                        .addComponent(jLabel5))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(139, 139, 139)
                        .addComponent(jButton1,  GroupLayout.PREFERRED_SIZE, 213,  GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jButton2,  GroupLayout.PREFERRED_SIZE, 194,  GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(148, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup( GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel4,  GroupLayout.PREFERRED_SIZE, 51,  GroupLayout.PREFERRED_SIZE)
                .addGap(28, 28, 28)
                .addGroup(jPanel1Layout.createParallelGroup( GroupLayout.Alignment.BASELINE)
                    .addComponent(jTextField2,  GroupLayout.PREFERRED_SIZE,  GroupLayout.DEFAULT_SIZE,  GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1,  GroupLayout.PREFERRED_SIZE, 20,  GroupLayout.PREFERRED_SIZE))
                .addGap(29, 29, 29)
                .addGroup(jPanel1Layout.createParallelGroup( GroupLayout.Alignment.BASELINE)
                    .addComponent(jp1,  GroupLayout.PREFERRED_SIZE,  GroupLayout.DEFAULT_SIZE,  GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2,  GroupLayout.PREFERRED_SIZE, 20,  GroupLayout.PREFERRED_SIZE))
                .addGap(27, 27, 27)
                .addComponent(jLabel5)
                .addGap(31, 31, 31)
                .addComponent(jButton1,  GroupLayout.PREFERRED_SIZE, 55,  GroupLayout.PREFERRED_SIZE)
                .addPreferredGap( LayoutStyle.ComponentPlacement.RELATED, 61, Short.MAX_VALUE)
                .addComponent(jButton2)
                .addContainerGap())
        );

         GroupLayout layout = new  GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup( GroupLayout.Alignment.LEADING)
            .addGroup( GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel3,  GroupLayout.DEFAULT_SIZE,  GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup(layout.createParallelGroup( GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGap(0, 0, Short.MAX_VALUE)
                    .addComponent(jPanel1,  GroupLayout.PREFERRED_SIZE,  GroupLayout.DEFAULT_SIZE,  GroupLayout.PREFERRED_SIZE)
                    .addGap(0, 0, Short.MAX_VALUE)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup( GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel3,  GroupLayout.PREFERRED_SIZE, 51,  GroupLayout.PREFERRED_SIZE)
                .addContainerGap(323, Short.MAX_VALUE))
            .addGroup(layout.createParallelGroup( GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGap(0, 0, Short.MAX_VALUE)
                    .addComponent(jPanel1,  GroupLayout.PREFERRED_SIZE,  GroupLayout.DEFAULT_SIZE,  GroupLayout.PREFERRED_SIZE)
                    .addGap(0, 0, Short.MAX_VALUE)))
        );
        setResizable(false);
        pack();
    }                     

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {    
    	validateInput();    
    }                                        
    
    public static void paintFrame(){
    	java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
            	one = new Login();
            	 JFrame frame = (JFrame) SwingUtilities.getRoot(jButton1);
               	 one.centerWindow(frame);
                    one.setVisible(true);
            }
        });
    }
    
    public static void validateInput(){
      user = new User(jTextField2.getText());
      String username = jTextField2.getText();
  	  char[] input2C = jp1.getPassword();
  	  String password = new String(input2C);
  	  if (help.queryUsernamePassword(username, help.encrypt(password))){
    		  jLabel5.setVisible(false);	

    		try {
				Profile.paintFrame(user);
				
				//remove this line:
				//AddEvent.paintFrame(new User(username));
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
				///////////////////////////////////////////////////////////////////////////////////////
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
    		  one.rootPane.repaint();
    		  one.setVisible(false);
  	  }
  	  else
  	      jLabel5.setVisible(true);	
    }
    
    public static void centerWindow(Window frame){
    	Dimension dimension = Toolkit.getDefaultToolkit().getScreenSize();
    	int x = (int) ((dimension.getWidth() - frame.getWidth())/2);
    	int y = (int) ((dimension.getHeight() - frame.getHeight())/2);
    
    	frame.setLocation(x, y);
    }
    
    public static void main(String args[]) {
         try {
            for (UIManager.LookAndFeelInfo info :  UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                     UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(Login.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(Login.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(Login.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch ( UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(Login.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }

         java.awt.EventQueue.invokeLater(new Runnable() {
             public void run() {
             	paintFrame();
             }
         });
    }
}
    
