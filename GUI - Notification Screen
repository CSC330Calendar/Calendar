
import javax.swing.*;
import javax.swing.event.*;
import javax.swing.table.*;
import java.awt.*;
import java.awt.event.*;
import java.util.ArrayList;
import java.util.Vector;

public class NotificationScreen {
	
	static JFrame frmMain;
	static Container notifPane;
	//static DefaultTableModel mtblNotifications;
	static JTable tblGroupNotifications, tblEventNotifications, tblEventWasRejected;
	static JScrollPane stblGroupNotifications, stblEventNotifications, stblEventWasRejected;
	static JPanel pnlNotifications;
	static JLabel lblGroupNotifications, lblEventNotifications, lblEventWasRejected;
	static MyGroupNotificationTableModel mtblGroupNotifications;
	static MyEventRejectedTableModel mtblEventWasRejected;
	static MyEventNotificationTableModel mtblEventNotifications;
	static JButton submitBtn;
	private static SQLHelper sqlHelper = new SQLHelper();
	private static ArrayList<Notification_Group> groups;
	private static ArrayList<Event> events;
	private static ArrayList<CancelledEventNotification> cancelledEvents;
	
	
	static private void prepareFrame(){
		try {
			UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (InstantiationException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IllegalAccessException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (UnsupportedLookAndFeelException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		String lcOSName = System.getProperty("os.name").toLowerCase();
		boolean IS_MAC = lcOSName.startsWith("mac os x");
		System.setProperty("apple.laf.useScreenMenuBar", String.valueOf(IS_MAC));
		
		frmMain = new JFrame("Group Calendar");
		frmMain.setSize(550, 385);
		notifPane = frmMain.getContentPane();
		notifPane.setLayout(null);
		frmMain.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE); //Close when X is clicked
		
	}
	private static void setUpTables(User user){

		mtblGroupNotifications = new MyGroupNotificationTableModel();
		
		groups = (user.getGroupNotifications());
		events = (user.getEventNotifications());
		cancelledEvents = (user.getCancelledEventNotifications());
		
		
		for(int i = 0; i < groups.size(); i++){
			mtblGroupNotifications.addRow(new Object[]{groups.get(i).getGroupName(),false, false});
		}
		
		
		tblGroupNotifications = new JTable(mtblGroupNotifications);
		tblGroupNotifications.getColumnModel().getColumn(0).setPreferredWidth(450);
		tblGroupNotifications.getColumnModel().getColumn(1).setPreferredWidth(50);
		tblGroupNotifications.getColumnModel().getColumn(2).setPreferredWidth(50);
		
		//Now set up rejection notifications
		
				mtblEventWasRejected = new MyEventRejectedTableModel();
				
				tblEventWasRejected = new JTable(mtblEventWasRejected);
				tblEventWasRejected.getColumnModel().getColumn(0).setPreferredWidth(90);
				tblEventWasRejected.getColumnModel().getColumn(1).setPreferredWidth(90);
				tblEventWasRejected.getColumnModel().getColumn(2).setPreferredWidth(105);
				tblEventWasRejected.getColumnModel().getColumn(3).setPreferredWidth(185);
				tblEventWasRejected.getColumnModel().getColumn(4).setPreferredWidth(80);
				
				for(int i = 0; i < cancelledEvents.size(); i++){
					mtblEventWasRejected.addRow(new Object[]{cancelledEvents.get(i).getDate(), cancelledEvents.get(i).getStartTime(), cancelledEvents.get(i).getGroupName(), cancelledEvents.get(i).getEventName(), false});
					
				}
				
				//mtblEventWasRejected.addRow(new Object[]{"04/25/2016", "5:00 PM", "9:00 PM", "Finish Project",false});
		
	//Now set up event notifications
		
		mtblEventNotifications = new MyEventNotificationTableModel();
		
		
		
		for(int i = 0; i < events.size(); i++){
			String amOrPm = "";
			String changeFromMilitaryTime;
			if(Integer.parseInt(events.get(i).getEndTime().substring(0,2)) > 12){
				changeFromMilitaryTime = String.valueOf((Integer.parseInt(events.get(i).getEndTime().substring(0,2))%2));
				amOrPm = "PM";
			}
			else{
				changeFromMilitaryTime = String.valueOf(Integer.parseInt(events.get(i).getEndTime().substring(0,2)));
				amOrPm = "AM";
			}
				
			String timeForEvent = events.get(i).getStartTime().substring(0, 5) + "-" + changeFromMilitaryTime + events.get(i).getEndTime().substring(2,5) + amOrPm;
			mtblEventNotifications.addRow(new Object[]{events.get(i).getEventDate(), timeForEvent/*events.get(i).getStartTime()*/, events.get(i).getId(), events.get(i).getEventName(),false, false});
		}
		
		/*
		for(int i = 0; i < 30; i++){
			mtblEventNotifications.addRow(new Object[]{"04/15/2016", "12:00 PM", "1:00 PM", "Finish Project" + String.valueOf(i),false, false});
		}
		*/
		
		tblEventNotifications = new JTable(mtblEventNotifications);
		tblEventNotifications.getColumnModel().getColumn(0).setPreferredWidth(80);
		tblEventNotifications.getColumnModel().getColumn(1).setPreferredWidth(100);
		tblEventNotifications.getColumnModel().getColumn(2).setPreferredWidth(105);
		tblEventNotifications.getColumnModel().getColumn(3).setPreferredWidth(175);
		tblEventNotifications.getColumnModel().getColumn(4).setPreferredWidth(45);
		tblEventNotifications.getColumnModel().getColumn(5).setPreferredWidth(45);
		
		
		tblEventNotifications.addMouseListener(new MouseAdapter() {
		    public void mousePressed(MouseEvent me) {
		        JTable table =(JTable) me.getSource();
		        Point p = me.getPoint();
		        int row = table.rowAtPoint(p);
		        if (me.getClickCount() == 2) {
		           EventDetails.paintFrame((Event)table.getValueAt(row, 0), user);
		        }
		    }
		});
		
	}
	
	private static void centerWindow(Window frame) {
	    Dimension dimension = Toolkit.getDefaultToolkit().getScreenSize();
	    int x = (int) ((dimension.getWidth() - frame.getWidth())/2);
	    int y = (int) ((dimension.getHeight() - frame.getHeight())/2);
	    frame.setLocation(x, y);
	}
	
	private static void createControls(){
		
		
		pnlNotifications = new JPanel(null);
		
		stblGroupNotifications = new JScrollPane(tblGroupNotifications);
		
		stblEventNotifications = new JScrollPane(tblEventNotifications);
		
		stblEventWasRejected = new JScrollPane(tblEventWasRejected);
		
		if(groups.size() == 1)
			lblGroupNotifications = new JLabel("You a group invitation!", SwingConstants.CENTER );
		else
		lblGroupNotifications = new JLabel("You have " + groups.size()+ " group invitations!", SwingConstants.CENTER );
		if(events.size() == 1)
			lblEventNotifications = new JLabel("You have an event awaiting your answer.", SwingConstants.CENTER);
		else
		lblEventNotifications = new JLabel("You have " + events.size() + " events awaiting your answer.", SwingConstants.CENTER);
		if(cancelledEvents.size() == 1)
			lblEventWasRejected = new JLabel("The following event has been rejected.", SwingConstants.CENTER);
		else
		lblEventWasRejected = new JLabel("The following " + cancelledEvents.size() +" events have been rejected.", SwingConstants.CENTER);
		
		submitBtn = new JButton("Submit");
		
	}
	
	
	static private void addControls(){
		notifPane.add(pnlNotifications);
		pnlNotifications.add(stblGroupNotifications);
		pnlNotifications.add(lblGroupNotifications);
		pnlNotifications.add(stblEventNotifications);
		pnlNotifications.add(lblEventNotifications);
		pnlNotifications.add(stblEventWasRejected);
		pnlNotifications.add(lblEventWasRejected);
		pnlNotifications.add(submitBtn);
		frmMain.setJMenuBar(MenuExp.PrepareMenuBar(new User("Moshe")));
	}
	
	static private void setBounds(User user){
		
		pnlNotifications.setBounds(0,0,550,550);
		
		lblGroupNotifications.setBounds(0, 7, 550, 20);
		stblGroupNotifications.setBounds(0,30,550,98);
		stblGroupNotifications.setAlignmentX(Frame.LEFT_ALIGNMENT);
		
		lblEventNotifications.setBounds(0, 131, 550, 20);
		stblEventNotifications.setBounds(0,158,550,98);
		stblEventNotifications.setAlignmentX(Frame.LEFT_ALIGNMENT);
		
		lblEventWasRejected.setBounds(0,259,550,20);
		stblEventWasRejected.setBounds(0,286,550,385-286);
		stblEventWasRejected.setAlignmentX(Frame.LEFT_ALIGNMENT);
		
		submitBtn.setBounds(450,7,75,20);
		
		submitBtn.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                submitBtnActionPerformed(evt, user);
            }
        });
	
